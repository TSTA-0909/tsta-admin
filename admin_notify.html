<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>é€šçŸ¥é€ä¿¡ï¼ˆç®¡ç†è€…ï¼‰</title>
</head>
<body>
  <h2>ğŸ”” ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸é€šçŸ¥ã‚’é€ã‚‹</h2>

  <label>é€šçŸ¥ã‚¿ã‚¤ãƒˆãƒ«ï¼š<input type="text" id="title" style="width: 100%;"></label><br>
  <label>é€šçŸ¥æœ¬æ–‡ï¼š<input type="text" id="body" style="width: 100%;"></label><br><br>
  <button onclick="sendToAll()">å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é€šçŸ¥</button>

  <p id="status"></p>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.0/firebase-app.js";
    import {
      getFirestore, collection, getDocs
    } from "https://www.gstatic.com/firebasejs/11.8.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyC3pcdWqFwrvokCUyGGJlg_ruQ-6wUSZT8",
      authDomain: "tsta-reserve.firebaseapp.com",
      projectId: "tsta-reserve",
      storageBucket: "tsta-reserve.appspot.com",
      messagingSenderId: "242251329752",
      appId: "1:242251329752:web:f70718703ba8e35298a7ad"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const serverKey = "â˜…â˜…â˜…ã“ã“ã«ã‚µãƒ¼ãƒãƒ¼ã‚­ãƒ¼ã‚’è²¼ã‚‹â˜…â˜…â˜…"; // å…¬é–‹ã—ãªã„ã§ï¼

    async function sendToAll() {
      const title = document.getElementById("title").value.trim();
      const body = document.getElementById("body").value.trim();
      const status = document.getElementById("status");

      if (!title || !body) {
        status.textContent = "ã‚¿ã‚¤ãƒˆãƒ«ã¨æœ¬æ–‡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„";
        return;
      }

      const snap = await getDocs(collection(db, "tokens"));
      let success = 0, fail = 0;

      for (const doc of snap.docs) {
        const token = doc.data().token;
        const payload = {
          notification: { title, body },
          to: token
        };

        const res = await fetch("https://fcm.googleapis.com/fcm/send", {
          method: "POST",
          headers: {
            "Authorization": "key=" + serverKey,
            "Content-Type": "application/json"
          },
          body: JSON.stringify(payload)
        });

        const json = await res.json();
        if (json.success === 1 || json.message_id) success++;
        else fail++;
      }

      status.textContent = `âœ… æˆåŠŸ: ${success}ä»¶ï¼âŒ å¤±æ•—: ${fail}ä»¶`;
    }
  </script>
</body>
</html>
